<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Tacklor Mark - Carnet de P√™che IA</title>
    
    <!-- 1. Assets & Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              glass: { 100: 'rgba(255, 255, 255, 0.1)', dark: 'rgba(0, 0, 0, 0.6)' },
              brand: { main: '#3b82f6', accent: '#8b5cf6' }
            },
            fontFamily: { sans: ['Inter', 'sans-serif'] },
            backdropBlur: { 'xs': '2px' }
          },
        },
      }
    </script>
    <style>
      :root { --glass-border: rgba(255, 255, 255, 0.15); }
      body {
        font-family: 'Inter', sans-serif;
        background-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiYWwMD27VB-_OQ7OrwaiBqJ-7lNELdUS4CYyrelQi_0blK4duusIiPywZlzSoLPCGjK6p0YfV55PcwkgafWvtJOi3MTmpHwYfhravhXRLRCCa2Mq0YaVfMdGTYT1tKB3whMRbQdQVt0RERB1UnOO1NepeTof4Ti7_k7GzZO53n4e3NfwuEPgXucIZPjDI/s16000/Fond%20Tropical.png');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        -webkit-font-smoothing: antialiased;
      }
      
      /* Glassmorphism Classes */
      .glass-panel {
        background: rgba(20, 20, 20, 0.6);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.07);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.2s ease, background 0.2s ease;
      }
      .glass-input {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        transition: border-color 0.2s;
      }
      .glass-input:focus {
        border-color: rgba(59, 130, 246, 0.6);
        outline: none;
      }

      /* Utilities */
      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>

    <!-- 2. React (UMD) & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/",
    "@google/genai": "https://esm.sh/@google/genai@^1.40.0"
  }
}
</script>
</head>
<body class="antialiased min-h-screen text-gray-100 overflow-x-hidden selection:bg-blue-500/30">

    <div id="root"></div>

    <!-- Error Handler -->
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            const root = document.getElementById('root');
            if(root) root.innerHTML += `<div style="color:red; background:black; padding:20px; border:1px solid red; margin:20px;">CRITICAL ERROR: ${msg}</div>`;
            return false;
        };
    </script>

    <!-- Application Logic -->
    <script type="text/babel" data-presets="env,react">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // ==========================================
        // 1. CONSTANTS & CONFIG
        // ==========================================
        const CONFIG = {
            STORAGE_KEYS: {
                LOGBOOK: 'tacklor_logbook_v1',
                API_KEY: 'tacklor_gemini_key',
                THEME: 'tacklor_theme'
            },
            MAX_IMAGE_WIDTH: 800,
            GEMINI_MODEL: 'gemini-2.0-flash-exp', // Using a fast, modern model
            API_URL: 'https://generativelanguage.googleapis.com/v1beta/models'
        };

        const TRANSLATIONS = {
            fr: {
                dashboard: {
                    title: "Carnet de P√™che",
                    emptyTitle: "Votre aventure commence ici",
                    emptySub: "Aucune prise enregistr√©e. Configurez votre cl√© API ou saisissez votre premi√®re capture manuellement.",
                    btnNew: "Nouvelle Prise",
                    statCount: "Prises",
                    statWeight: "Poids Total",
                    statCompliant: "Conformit√©"
                },
                settings: {
                    title: "Param√®tres",
                    apiKeyLabel: "Cl√© API Google Gemini",
                    apiKeyPlaceholder: "Collez votre cl√© ici (AI Studio)",
                    save: "Sauvegarder",
                    saved: "Cl√© enregistr√©e !",
                    noKey: "Mode Manuel (IA Inactive)",
                    hasKey: "IA Active",
                    help: "Obtenir une cl√© gratuitement sur Google AI Studio"
                },
                form: {
                    title: "D√©tails de la prise",
                    upload: "Photo de la prise",
                    uploadHint: "Appuyez pour ajouter une photo",
                    analyzing: "Analyse IA en cours...",
                    analyzeBtn: "Analyser l'image",
                    manualMode: "Saisie Manuelle (Pas de Cl√© API)",
                    save: "Enregistrer la prise",
                    fields: {
                        species: "Esp√®ce",
                        length: "Taille (cm)",
                        weight: "Poids (kg)",
                        technique: "Technique",
                        spot: "Type de poste",
                        weather: "M√©t√©o (Ciel, Temp...)",
                        tide: "Mar√©e / Phase"
                    },
                    compliance: {
                        legal: "L√©gal",
                        check: "V√©rifier",
                        warning: "Attention (Taille/Esp√®ce)",
                        compliant: "Conforme"
                    }
                }
            }
        };

        // ==========================================
        // 2. UTILS & SERVICES
        // ==========================================
        
        const Utils = {
            generateUUID: () => {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                    const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            },

            compressImage: (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = (e) => {
                        const img = new Image();
                        img.src = e.target.result;
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            let { width, height } = img;
                            if (width > height) {
                                if (width > CONFIG.MAX_IMAGE_WIDTH) { height *= CONFIG.MAX_IMAGE_WIDTH / width; width = CONFIG.MAX_IMAGE_WIDTH; }
                            } else {
                                if (height > CONFIG.MAX_IMAGE_WIDTH) { width *= CONFIG.MAX_IMAGE_WIDTH / height; height = CONFIG.MAX_IMAGE_WIDTH; }
                            }
                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            resolve(canvas.toDataURL('image/jpeg', 0.7));
                        };
                        img.onerror = reject;
                    };
                    reader.onerror = reject;
                });
            },

            formatDate: (isoString) => {
                return new Date(isoString).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', year: 'numeric' });
            }
        };

        const StorageService = {
            getLogbook: () => JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.LOGBOOK) || '[]'),
            saveLogbook: (data) => localStorage.setItem(CONFIG.STORAGE_KEYS.LOGBOOK, JSON.stringify(data)),
            getApiKey: () => localStorage.getItem(CONFIG.STORAGE_KEYS.API_KEY) || '',
            saveApiKey: (key) => localStorage.setItem(CONFIG.STORAGE_KEYS.API_KEY, key)
        };

        const GeminiService = {
            analyze: async (base64Image, apiKey) => {
                if (!apiKey) throw new Error("Cl√© API manquante");

                const prompt = `
                Analyse cette image de p√™che. R√©ponds UNIQUEMENT avec un objet JSON strict sans markdown.
                Champs requis:
                - species (string, nom commun fran√ßais)
                - length_cm (number, estimation)
                - weight_kg (number, estimation)
                - technique (string, d√©duite du mat√©riel ou contexte)
                - spot_type (string, ex: Rivi√®re, Mer, Lac)
                - compliance_check (boolean, est-ce une esp√®ce prot√©g√©e ou trop petite ? true si ok, false si doute)
                `;

                // Nettoyage du base64 si n√©cessaire (retirer le pr√©fixe data:image...)
                const cleanBase64 = base64Image.split(',')[1] || base64Image;

                const body = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            { inline_data: { mime_type: "image/jpeg", data: cleanBase64 } }
                        ]
                    }],
                    generationConfig: {
                        response_mime_type: "application/json"
                    }
                };

                const response = await fetch(`${CONFIG.API_URL}/${CONFIG.GEMINI_MODEL}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                if (!response.ok) throw new Error(`Erreur API: ${response.status}`);
                
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("Pas de r√©ponse de l'IA");

                return JSON.parse(text);
            }
        };

        // ==========================================
        // 3. COMPONENTS
        // ==========================================

        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                fish: <path strokeLinecap="round" strokeLinejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />,
                plus: <path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" />,
                settings: <path strokeLinecap="round" strokeLinejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />,
                check: <path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" />,
                alert: <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />,
                camera: <path strokeLinecap="round" strokeLinejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />,
                x: <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
            };
            return (
                <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                    {icons[name]}
                </svg>
            );
        };

        const StatusBadge = ({ compliant }) => {
            const style = compliant 
                ? "bg-green-500/20 text-green-300 border-green-500/30"
                : "bg-red-500/20 text-red-300 border-red-500/30";
            const text = compliant 
                ? TRANSLATIONS.fr.form.compliance.compliant 
                : TRANSLATIONS.fr.form.compliance.warning;
            
            return (
                <span className={`px-2 py-1 rounded-full text-xs font-semibold border flex items-center gap-1 ${style}`}>
                    <Icon name={compliant ? "check" : "alert"} className="w-3 h-3" />
                    {text}
                </span>
            );
        };

        // Optimized for list rendering
        const CatchCard = React.memo(({ item }) => (
            <div className="glass-card rounded-2xl overflow-hidden group hover:bg-white/10 flex flex-col h-full">
                <div className="relative aspect-[4/3] bg-gray-900">
                    <img src={item.imageUrl} alt={item.species} className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" loading="lazy" />
                    <div className="absolute top-2 right-2">
                        <StatusBadge compliant={item.isCompliant} />
                    </div>
                    <div className="absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/90 to-transparent">
                        <div className="text-white font-bold text-lg">{item.species || "Esp√®ce inconnue"}</div>
                        <div className="text-xs text-white/70">{Utils.formatDate(item.date)}</div>
                    </div>
                </div>
                <div className="p-4 grid grid-cols-2 gap-2 text-sm text-gray-300">
                    <div>üìè {item.length} cm</div>
                    <div>‚öñÔ∏è {item.weight} kg</div>
                    {item.technique && <div className="col-span-2 text-xs opacity-70">üé£ {item.technique}</div>}
                    {item.weather && <div className="col-span-2 text-xs opacity-70">‚òÅÔ∏è {item.weather}</div>}
                </div>
            </div>
        ));

        const EmptyState = ({ onSetup }) => (
            <div className="glass-panel rounded-3xl p-10 text-center max-w-lg mx-auto mt-10">
                <div className="w-20 h-20 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-6 border border-blue-500/30">
                    <Icon name="fish" className="w-10 h-10 text-blue-300" />
                </div>
                <h2 className="text-2xl font-bold text-white mb-2">{TRANSLATIONS.fr.dashboard.emptyTitle}</h2>
                <p className="text-gray-400 mb-8">{TRANSLATIONS.fr.dashboard.emptySub}</p>
                <button onClick={onSetup} className="text-blue-400 hover:text-blue-300 underline font-medium">
                    Configurer la Cl√© API maintenant
                </button>
            </div>
        );

        const SettingsModal = ({ isOpen, onClose, apiKey, onSave }) => {
            const [inputKey, setInputKey] = useState(apiKey);

            useEffect(() => setInputKey(apiKey), [apiKey, isOpen]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/80 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="glass-panel relative w-full max-w-md rounded-2xl p-6 shadow-2xl animate-[fadeIn_0.2s_ease-out]">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white">
                            <Icon name="x" />
                        </button>
                        <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                            <Icon name="settings" /> {TRANSLATIONS.fr.settings.title}
                        </h3>
                        
                        <div className="mb-4">
                            <label className="block text-sm text-gray-400 mb-2">{TRANSLATIONS.fr.settings.apiKeyLabel}</label>
                            <input 
                                type="password" 
                                value={inputKey}
                                onChange={(e) => setInputKey(e.target.value)}
                                placeholder={TRANSLATIONS.fr.settings.apiKeyPlaceholder}
                                className="glass-input w-full rounded-lg px-4 py-3 text-sm font-mono"
                            />
                        </div>
                        
                        <div className="flex items-center justify-between mb-6">
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-xs text-blue-400 hover:underline">
                                {TRANSLATIONS.fr.settings.help}
                            </a>
                            <div className={`text-xs px-2 py-1 rounded ${inputKey ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}`}>
                                {inputKey ? TRANSLATIONS.fr.settings.hasKey : TRANSLATIONS.fr.settings.noKey}
                            </div>
                        </div>

                        <button 
                            onClick={() => { onSave(inputKey); onClose(); }}
                            className="w-full py-3 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-bold transition-all shadow-lg shadow-blue-600/20"
                        >
                            {TRANSLATIONS.fr.settings.save}
                        </button>
                    </div>
                </div>
            );
        };

        const NewCatchForm = ({ apiKey, onSave, onCancel }) => {
            const [image, setImage] = useState(null);
            const [preview, setPreview] = useState(null);
            const [loading, setLoading] = useState(false);
            const [data, setData] = useState({
                species: '', length: '', weight: '', technique: '', spot: '', weather: '', tide: '',
                isCompliant: true
            });

            const handleImage = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                // Immediate preview
                setPreview(URL.createObjectURL(file));
                
                try {
                    const compressed = await Utils.compressImage(file);
                    setImage(compressed);

                    // Auto-Analyze if Key is present
                    if (apiKey) {
                        setLoading(true);
                        const analysis = await GeminiService.analyze(compressed, apiKey);
                        setData(prev => ({
                            ...prev,
                            species: analysis.species || '',
                            length: analysis.length_cm || '',
                            weight: analysis.weight_kg || '',
                            technique: analysis.technique || '',
                            spot: analysis.spot_type || '',
                            isCompliant: analysis.compliance_check !== false // Default to true if undefined
                        }));
                    }
                } catch (err) {
                    console.error("Image processing error", err);
                    alert("Erreur analyse: " + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleSubmit = () => {
                if (!image) return alert("Photo requise");
                onSave({
                    id: Utils.generateUUID(),
                    date: new Date().toISOString(),
                    imageUrl: image,
                    ...data
                });
            };

            const t = TRANSLATIONS.fr.form;

            return (
                <div className="glass-panel w-full max-w-2xl mx-auto rounded-3xl overflow-hidden shadow-2xl animate-[slideUp_0.3s_ease-out]">
                    <div className="bg-black/20 p-4 flex justify-between items-center border-b border-white/5">
                        <button onClick={onCancel} className="text-gray-400 hover:text-white flex items-center gap-1 text-sm">
                            ‚Üê Retour
                        </button>
                        <h2 className="font-bold">{t.title}</h2>
                        <div className="w-10"></div>
                    </div>

                    <div className="p-6 space-y-6 max-h-[85vh] overflow-y-auto scrollbar-hide">
                        {/* Image Upload Area */}
                        <div className="relative w-full aspect-video bg-black/40 rounded-xl border-2 border-dashed border-white/20 flex flex-col items-center justify-center overflow-hidden group">
                            {preview ? (
                                <img src={preview} className="w-full h-full object-cover" />
                            ) : (
                                <div className="text-center p-4">
                                    <Icon name="camera" className="w-8 h-8 mx-auto mb-2 text-gray-500" />
                                    <p className="text-sm text-gray-400">{t.uploadHint}</p>
                                </div>
                            )}
                            <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" accept="image/*" onChange={handleImage} />
                            
                            {loading && (
                                <div className="absolute inset-0 bg-black/60 flex items-center justify-center backdrop-blur-sm">
                                    <div className="flex flex-col items-center">
                                        <div className="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
                                        <span className="text-xs font-mono text-blue-300 blink">{t.analyzing}</span>
                                    </div>
                                </div>
                            )}
                        </div>

                        {!apiKey && !loading && (
                            <div className="text-center text-xs text-yellow-500/80 bg-yellow-900/10 p-2 rounded border border-yellow-500/20">
                                {t.manualMode}
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="text-xs text-gray-400 block mb-1">{t.fields.species}</label>
                                <input type="text" className="glass-input w-full rounded p-3" value={data.species} onChange={e => setData({...data, species: e.target.value})} />
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <label className="text-xs text-gray-400 block mb-1">{t.fields.length}</label>
                                    <input type="number" className="glass-input w-full rounded p-3" value={data.length} onChange={e => setData({...data, length: e.target.value})} />
                                </div>
                                <div>
                                    <label className="text-xs text-gray-400 block mb-1">{t.fields.weight}</label>
                                    <input type="number" className="glass-input w-full rounded p-3" value={data.weight} onChange={e => setData({...data, weight: e.target.value})} />
                                </div>
                            </div>
                            <div>
                                <label className="text-xs text-gray-400 block mb-1">{t.fields.weather}</label>
                                <input type="text" placeholder="Ex: Ensoleill√©, 22¬∞C" className="glass-input w-full rounded p-3" value={data.weather} onChange={e => setData({...data, weather: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-xs text-gray-400 block mb-1">{t.fields.tide}</label>
                                <input type="text" placeholder="Ex: Montante, coef 85" className="glass-input w-full rounded p-3" value={data.tide} onChange={e => setData({...data, tide: e.target.value})} />
                            </div>
                        </div>

                        <button onClick={handleSubmit} className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg transition-all transform active:scale-95">
                            {t.save}
                        </button>
                    </div>
                </div>
            );
        };

        // ==========================================
        // 4. MAIN APP CONTROLLER
        // ==========================================

        const App = () => {
            const [view, setView] = useState('DASHBOARD'); // DASHBOARD, NEW
            const [logbook, setLogbook] = useState([]);
            const [apiKey, setApiKey] = useState('');
            const [showSettings, setShowSettings] = useState(false);

            // Load Initial Data
            useEffect(() => {
                setLogbook(StorageService.getLogbook());
                setApiKey(StorageService.getApiKey());
            }, []);

            const handleSaveCatch = (newCatch) => {
                const updated = [newCatch, ...logbook];
                setLogbook(updated);
                StorageService.saveLogbook(updated);
                setView('DASHBOARD');
            };

            const handleSaveKey = (key) => {
                setApiKey(key);
                StorageService.saveApiKey(key);
            };

            const t = TRANSLATIONS.fr.dashboard;

            return (
                <div className="min-h-screen pb-20 relative">
                    {/* Header */}
                    <header className="fixed top-0 w-full z-40 px-4 py-4">
                        <div className="glass-panel max-w-5xl mx-auto rounded-full px-6 py-3 flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('DASHBOARD')}>
                                <div className="w-8 h-8 bg-gradient-to-tr from-blue-500 to-purple-500 rounded-full flex items-center justify-center shadow-lg">
                                    <Icon name="fish" className="text-white w-5 h-5" />
                                </div>
                                <h1 className="font-bold text-lg tracking-tight hidden sm:block">{t.title}</h1>
                            </div>
                            <div className="flex items-center gap-3">
                                {apiKey ? (
                                    <span className="text-[10px] bg-green-500/20 text-green-300 border border-green-500/30 px-2 py-0.5 rounded-full flex items-center gap-1">
                                        <span className="w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></span> IA Active
                                    </span>
                                ) : (
                                    <span className="text-[10px] bg-gray-500/20 text-gray-400 border border-gray-500/30 px-2 py-0.5 rounded-full">Manuel</span>
                                )}
                                <button onClick={() => setShowSettings(true)} className="p-2 hover:bg-white/10 rounded-full transition-colors">
                                    <Icon name="settings" />
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="pt-24 px-4 max-w-5xl mx-auto">
                        {view === 'DASHBOARD' && (
                            <>
                                {/* Floating Action Button for Mobile */}
                                <button 
                                    onClick={() => setView('NEW')}
                                    className="fixed bottom-6 right-6 z-50 w-14 h-14 bg-blue-600 hover:bg-blue-500 text-white rounded-full shadow-lg shadow-blue-600/40 flex items-center justify-center transition-transform hover:scale-105 active:scale-95 md:hidden"
                                >
                                    <Icon name="plus" className="w-8 h-8" />
                                </button>

                                {/* Desktop Action Bar */}
                                <div className="flex justify-between items-end mb-8">
                                    <div className="flex gap-4">
                                        <div className="text-center">
                                            <div className="text-2xl font-bold">{logbook.length}</div>
                                            <div className="text-xs text-gray-400 uppercase tracking-wider">{t.statCount}</div>
                                        </div>
                                        <div className="w-px bg-white/10"></div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold">
                                                {logbook.reduce((acc, c) => acc + (parseFloat(c.weight) || 0), 0).toFixed(1)} <span className="text-sm font-normal">kg</span>
                                            </div>
                                            <div className="text-xs text-gray-400 uppercase tracking-wider">{t.statWeight}</div>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={() => setView('NEW')} 
                                        className="hidden md:flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold shadow-lg shadow-blue-600/20 transition-all"
                                    >
                                        <Icon name="plus" /> {t.btnNew}
                                    </button>
                                </div>

                                {/* Grid */}
                                {logbook.length === 0 ? (
                                    <EmptyState onSetup={() => setShowSettings(true)} />
                                ) : (
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {logbook.map(item => <CatchCard key={item.id} item={item} />)}
                                    </div>
                                )}
                            </>
                        )}

                        {view === 'NEW' && (
                            <NewCatchForm 
                                apiKey={apiKey} 
                                onSave={handleSaveCatch} 
                                onCancel={() => setView('DASHBOARD')} 
                            />
                        )}
                    </main>

                    <SettingsModal 
                        isOpen={showSettings} 
                        onClose={() => setShowSettings(false)} 
                        apiKey={apiKey} 
                        onSave={handleSaveKey} 
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>